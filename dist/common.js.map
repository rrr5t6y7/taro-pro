{"version":3,"file":"common.js","sources":["webpack:///./src/pages/buy/service.js","webpack:///./src/utils/request.ts"],"sourcesContent":["/*\n * @Author: JJ\n * @Title: api存放处\n * @Description: 请写好注释和文档地址\n * @Date: 2021-10-26 10:52:27\n * @Last Modified by: JJ\n * @Last Modified time: 2021-10-27 16:06:26\n */\n\nconst api = {\n  searchList: \"/search-ms/v4/search\",\n  detail: \"/ds-product-api/productPresell/customer/getPresellInfo\",\n};\n\nexport default api;\n","import Taro from \"@tarojs/taro\";\n\n/**\n * 声明请求对象\n */\nconsole.log(process.env);\nconst API_BASE_URL = \"https://sit-api.tianhong.cn\";\n\n/**\n * 声明请求对象参数展示\n * requestHandler\n * params: {},\n * url: \"\",\n * showToast: false, //默认显示Toast，如果设置true则不会显示Toast\n * success: function (res)\n * fail: function ()\n *\n */\n\n/**\n * GET请求\n *\n */\nexport async function GET(requestHandler) {\n  return httpRequest(\"GET\", requestHandler);\n}\n/**\n * POST请求\n *\n */\nexport async function POST(requestHandler) {\n  // return new Promise((resolve, reject) => {\n  return httpRequest(\"POST\", requestHandler);\n  // });\n}\n/**\n * http request 请求\n * @param {http method} method\n *\n */\n\nexport async function httpRequest(method, requestHandler) {\n  //注意：可以对params签名等处理\n  let params = requestHandler.params;\n  params = apiParamSign(params);\n  let showToast = requestHandler.showToast;\n  let url = requestHandler.url;\n\n  if (!showToast) {\n    Taro.showLoading({\n      title: \"加载中\",\n      mask: true,\n    });\n  }\n\n  return Taro.request({\n    url: `${API_BASE_URL}/${url}`,\n    data: params,\n    method: method, // OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT\n    // responseType: 'text',\n    // credentials: 'include',\n    header: {\n      \"content-type\": \"application/json\", // 默认值\n      \"x-http-devicetype\": \"miniapp\",\n      // 'mediaType':'application/json'\n    },\n    mode: \"no-cors\",\n    success: function (res) {\n      console.log(\"request success!\");\n      if (!showToast) {\n        Taro.hideLoading();\n      }\n      if (res.data.code == 200) {\n        requestHandler.success(res.data);\n      } else if (res.data.status == \"error\") {\n        //错误回调处理\n        requestHandler.fail();\n        Taro.showToast({\n          title: res.data.msg,\n          icon: \"none\",\n        });\n      } else {\n        //其他情况当成失败处理\n        requestHandler.fail();\n      }\n    },\n    fail: function (res) {\n      console.log(\"request failed!\");\n      if (!showToast) {\n        Taro.hideLoading();\n      }\n      //错误回调处理\n      requestHandler.fail();\n    },\n  });\n}\n\n/**\n * 系统参数和功能参数做签名（按照服务端接口标准制定）\n * @param {传入功能参数} params\n */\nfunction apiParamSign(params) {\n  let sysParams = {};\n  // let date = new Date();\n  // let month = date.getMonth() + 1;\n  // sysParams.date =\n  //   date.getFullYear() +\n  //   \"-\" +\n  //   month +\n  //   \"-\" +\n  //   date.getDate() +\n  //   \" \" +\n  //   date.getHours() +\n  //   \":\" +\n  //   date.getMinutes() +\n  //   \":\" +\n  //   date.getSeconds();\n  // data.task = date.getTime();\n\n  // sysParams.version = \"1.0\";\n  // sysParams.format = \"json\";\n  // sysParams.flag = \"dev_flag\";\n\n  let data = {};\n  //合并对象\n  Object.assign(data, sysParams, params);\n\n  let keys = [];\n  for (var k in data) {\n    if (data.hasOwnProperty(k)) {\n      keys.push(k);\n    }\n  }\n  keys.sort();\n  let paramsStr = \"\";\n  for (var i = -0; i < keys.length; i++) {\n    paramsStr += keys[i];\n    paramsStr += data[keys[i]];\n  }\n  // let tmp = md5(paramsStr).toUpperCase() + API_BASE_TOKEN;\n  // tmp = md5(tmp).toUpperCase();\n  // data.sign = tmp;\n  return data;\n}\n"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAKA;;;;;;;;;;;;;;;;;;;;;;;ACdA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAOA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAWA;AAAA;AAAA;AAwDA;AACA;AACA;AACA;AACA;;AA5DA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAbA;AAeA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAtCA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AA4DA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;;;;;A","sourceRoot":""}